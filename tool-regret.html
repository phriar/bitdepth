<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BTC Regret Calculator ‚Äî BitDepth</title>
  <meta name="description" content="Enter how much you spent and on what date. See what it was worth in Bitcoin then vs now." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="shared.css" />
</head>
<body>

  <nav>
    <a class="logo" href="index.html">Bit<span>Depth</span></a>
    <ul class="nav-links">
      <li><a href="index.html#tools" style="color:var(--orange)">‚öô Tools</a></li>
      <li><a href="index.html#markets">Markets</a></li>
      <li><a href="index.html#onchain">On-Chain</a></li>
      <li><a href="index.html#macro">Macro</a></li>
      <li><a href="https://x.com/btc_journey" target="_blank" rel="noopener" style="color:var(--orange)">ùïè @btc_journey</a></li>
    </ul>
    <div class="nav-status">
      <div class="status-dot"></div>
      <span id="nav-last-updated">LIVE DATA</span>
    </div>
  </nav>

  <div class="tool-page-wrap">
    <a class="tool-page-back" href="index.html#tools">‚Üê Back to all tools</a>

    <div class="tool-page-card">
      <div class="tool-badge">TOOL 10</div>
      <div class="tool-page-title">üò¢ BTC Regret Calculator</div>
      <p class="tool-page-desc">Enter how much you spent ‚Äî and on what date. See exactly what that money would buy in Bitcoin back then, and what that stack would be worth at today's live price.</p>

      <div class="tool-section">
        <div class="tool-label">Amount Spent (USD)</div>
        <div class="conv-wrap">
          <span class="conv-prefix">$</span>
          <input id="regret-usd" class="conv-input" type="number" placeholder="100" min="0" step="any" inputmode="decimal" />
        </div>
      </div>

      <div class="tool-section">
        <div class="tool-label">Date of Purchase</div>
        <input id="regret-date" class="conv-input" type="date" style="padding-left:1rem" />
        <div class="tool-note" style="margin-top:0.4rem">Supports dates from October 2013. Pre-2024 uses monthly averages; 2024+ uses exact daily close via Binance.</div>
      </div>

      <button id="regret-calc-btn" class="tool-action-btn">Calculate My Regret ‚Üí</button>

      <div id="regret-result" style="display:none;margin-top:1.5rem">
        <div class="inf-compare">
          <div class="inf-col">
            <div class="inf-col-label">üìÖ BTC Price Then</div>
            <div id="regret-price-then" class="inf-col-val" style="color:var(--text)">‚Äî</div>
            <div id="regret-btc-then" class="inf-col-sub">loading...</div>
          </div>
          <div class="inf-vs">‚Üí</div>
          <div class="inf-col">
            <div class="inf-col-label">üí∞ Value Today</div>
            <div id="regret-value-now" class="inf-col-val">‚Äî</div>
            <div id="regret-gain" class="inf-col-sub">loading...</div>
          </div>
        </div>

        <div id="regret-summary" class="inf-summary"></div>

        <div id="regret-extra" style="background:var(--bg);border:1px solid var(--border);padding:1rem;margin-top:0.75rem">
          <div style="font-size:0.62rem;letter-spacing:0.12em;text-transform:uppercase;color:var(--muted);margin-bottom:0.75rem">BREAKDOWN</div>
          <div class="dca-result-row"><span class="dca-result-label">Amount spent</span><span id="re-spent" class="dca-result-val">‚Äî</span></div>
          <div class="dca-result-row"><span class="dca-result-label">BTC price on date</span><span id="re-price" class="dca-result-val">‚Äî</span></div>
          <div class="dca-result-row"><span class="dca-result-label">BTC you would have</span><span id="re-btc" class="dca-result-val" style="color:var(--orange)">‚Äî</span></div>
          <div class="dca-result-row"><span class="dca-result-label">Satoshis</span><span id="re-sats" class="dca-result-val" style="color:var(--orange)">‚Äî</span></div>
          <div class="dca-result-row"><span class="dca-result-label">Current BTC price</span><span id="re-now-price" class="dca-result-val">‚Äî</span></div>
          <div class="dca-result-row"><span class="dca-result-label">Value today</span><span id="re-value" class="dca-result-val" style="color:var(--green)">‚Äî</span></div>
          <div class="dca-result-row" style="border:none"><span class="dca-result-label">Gain / Loss</span><span id="re-gain" class="dca-result-val">‚Äî</span></div>
        </div>
      </div>

      <div id="regret-error" style="display:none;color:var(--red);font-size:0.75rem;margin-top:1rem;padding:0.75rem;background:rgba(255,77,77,0.06);border:1px solid rgba(255,77,77,0.2)"></div>

      <div class="tool-note" style="margin-top:1.5rem">Pre-2024 prices are monthly averages. 2024+ uses exact daily close via Binance. Current price via CoinGecko. Not financial advice.</div>
    </div>

    <!-- Related tools -->
    <div style="margin-top:2rem">
      <div style="font-size:0.62rem;letter-spacing:0.15em;text-transform:uppercase;color:var(--muted);margin-bottom:1rem">Also try</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:1px;background:var(--border);border:1px solid var(--border)">
        <a href="tool-inflation.html" style="background:var(--bg);padding:1.25rem;text-decoration:none;transition:background 0.2s" onmouseover="this.style.background='var(--bg3)'" onmouseout="this.style.background='var(--bg)'">
          <div style="font-size:0.6rem;color:var(--orange);letter-spacing:0.15em;text-transform:uppercase">Tool 03</div>
          <div style="font-family:var(--display);font-weight:800;font-size:0.95rem;color:var(--text);margin-top:0.25rem">üí∏ Bitcoin vs Inflation</div>
          <div style="font-size:0.7rem;color:var(--muted);margin-top:0.25rem">$100 in BTC vs holding dollars</div>
        </a>
        <a href="tool-satstack.html" style="background:var(--bg);padding:1.25rem;text-decoration:none;transition:background 0.2s" onmouseover="this.style.background='var(--bg3)'" onmouseout="this.style.background='var(--bg)'">
          <div style="font-size:0.6rem;color:var(--orange);letter-spacing:0.15em;text-transform:uppercase">Tool 01</div>
          <div style="font-family:var(--display);font-weight:800;font-size:0.95rem;color:var(--text);margin-top:0.25rem">üìà Sat Stack Calculator</div>
          <div style="font-size:0.7rem;color:var(--muted);margin-top:0.25rem">Model your DCA strategy</div>
        </a>
      </div>
    </div>
  </div>

  <footer>
    <div><strong style="color:var(--text)">BitDepth</strong> &nbsp;‚Äî&nbsp; Bitcoin Tools & Live Market Intel</div>
    <div>Not financial advice. &nbsp;|&nbsp; <a href="https://x.com/btc_journey" target="_blank" rel="noopener">ùïè @btc_journey</a></div>
  </footer>

  <script src="shared.js"></script>
  <script>
    // Load current BTC price from cache or fresh
    let currentPrice = 0;

    async function loadCurrentPrice() {
      currentPrice = await fetchBtcPriceMini();
      if (currentPrice > 0) {
        $('re-now-price').textContent = '$' + fmt(currentPrice);
        updateNavTime();
      }
    }

    $('regret-calc-btn').addEventListener('click', async function() {
      const usdVal = $('regret-usd').value;
      const dateVal = $('regret-date').value;
      const errEl = $('regret-error');
      const resEl = $('regret-result');

      errEl.style.display = 'none';
      resEl.style.display = 'none';

      const usd = parseFloat(usdVal);
      if (!usd || usd <= 0) {
        errEl.textContent = 'Please enter a valid USD amount greater than zero.';
        errEl.style.display = 'block'; return;
      }
      if (!dateVal) {
        errEl.textContent = 'Please select a date.';
        errEl.style.display = 'block'; return;
      }

      // Date validation ‚Äî Kraken goes back to late 2013
      const chosen = new Date(dateVal + 'T12:00:00Z');
      const earliest = new Date('2013-10-01T12:00:00Z');
      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);

      if (chosen < earliest) {
        errEl.textContent = 'Earliest supported date is October 2013.';
        errEl.style.display = 'block'; return;
      }
      if (chosen > yesterday) {
        errEl.textContent = 'Please pick a date in the past (at least yesterday).';
        errEl.style.display = 'block'; return;
      }

      this.textContent = 'Fetching price data...';
      this.disabled = true;

      try {
        // Binance klines API ‚Äî free, CORS-friendly, full history back to 2017
        // For pre-2017 dates we fall back to a hardcoded price table
        const targetTs = chosen.getTime();
        let priceThen = null;

        // Monthly avg prices for pre-Binance era (Oct 2013 ‚Äì Aug 2017)
        const monthlyPrices = {
          '2013-10':195,'2013-11':742,'2013-12':732,
          '2014-01':825,'2014-02':637,'2014-03':558,'2014-04':450,'2014-05':445,
          '2014-06':635,'2014-07':621,'2014-08':511,'2014-09':400,'2014-10':340,
          '2014-11':375,'2014-12':320,
          '2015-01':230,'2015-02':252,'2015-03':268,'2015-04':238,'2015-05':234,
          '2015-06':243,'2015-07':283,'2015-08':268,'2015-09':236,'2015-10':278,
          '2015-11':355,'2015-12':380,
          '2016-01':374,'2016-02':382,'2016-03':416,'2016-04':449,'2016-05':454,
          '2016-06':574,'2016-07':625,'2016-08':572,'2016-09':604,'2016-10':639,
          '2016-11':699,'2016-12':847,
          '2017-01':908,'2017-02':1066,'2017-03':1168,'2017-04':1231,'2017-05':1777,
          '2017-06':2560,'2017-07':2607,'2017-08':4285,'2017-09':4350,'2017-10':5583,
          '2017-11':8196,'2017-12':14156,
          '2018-01':13412,'2018-02':8792,'2018-03':8580,'2018-04':8077,'2018-05':8474,
          '2018-06':6756,'2018-07':7411,'2018-08':6530,'2018-09':6618,'2018-10':6537,
          '2018-11':5601,'2018-12':3708,
          '2019-01':3541,'2019-02':3706,'2019-03':4028,'2019-04':5197,'2019-05':7638,
          '2019-06':9359,'2019-07':10556,'2019-08':10059,'2019-09':9565,'2019-10':8302,
          '2019-11':8521,'2019-12':7375,
          '2020-01':8065,'2020-02':9483,'2020-03':6482,'2020-04':7973,'2020-05':9456,
          '2020-06':9328,'2020-07':10277,'2020-08':11691,'2020-09':10778,'2020-10':13549,
          '2020-11':18099,'2020-12':23709,
          '2021-01':33114,'2021-02':46312,'2021-03':52394,'2021-04':57750,'2021-05':47174,
          '2021-06':35684,'2021-07':37330,'2021-08':45254,'2021-09':43879,'2021-10':57344,
          '2021-11':60218,'2021-12':50786,
          '2022-01':43099,'2022-02':40697,'2022-03':42282,'2022-04':41581,'2022-05':31390,
          '2022-06':22941,'2022-07':23302,'2022-08':23578,'2022-09':20179,'2022-10':20463,
          '2022-11':17163,'2022-12':16861,
          '2023-01':20695,'2023-02':23229,'2023-03':27450,'2023-04':29244,'2023-05':27021,
          '2023-06':27876,'2023-07':30233,'2023-08':29318,'2023-09':26966,'2023-10':30762,
          '2023-11':36197,'2023-12':42265
        };
        const monthKey = dateVal.slice(0, 7); // "YYYY-MM"

        if (monthlyPrices[monthKey]) {
          priceThen = monthlyPrices[monthKey];
          console.log('[regret] using monthly table:', monthKey, priceThen);
        } else if (chosen.getUTCFullYear() < 2024) {
          throw new Error('No price data available for that date.');
        } else {
          // Try Binance first, fall back to Kraken
          const startTime = targetTs;
          const endTime = targetTs + 86400000;

          try {
            console.log('[regret] trying Binance for', dateVal);
            const url = `https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1d&startTime=${startTime}&endTime=${endTime}&limit=1`;
            const res = await fetch(url);
            if (!res.ok) throw new Error(`Binance ${res.status}`);
            const klines = await res.json();
            if (!klines || klines.length === 0) throw new Error('empty');
            priceThen = parseFloat(klines[0][4]);
            console.log('[regret] Binance price:', priceThen);
          } catch (binanceErr) {
            console.warn('[regret] Binance failed:', binanceErr.message, '‚Äî trying Kraken');
            // Kraken: use daily OHLC, since = start of day - 1 day so target day is included
            const since = Math.floor(startTime / 1000) - 86400;
            const kurl = `https://api.kraken.com/0/public/OHLC?pair=XBTUSD&interval=1440&since=${since}`;
            const kres = await fetch(kurl);
            if (!kres.ok) throw new Error(`Kraken ${kres.status}`);
            const kdata = await kres.json();
            if (kdata.error && kdata.error.length) throw new Error('Kraken: ' + kdata.error[0]);
            const candles = kdata.result?.XXBTZUSD;
            if (!candles || candles.length === 0) throw new Error('No data from Kraken either.');
            // Find candle whose open time matches the target date
            const targetSec = Math.floor(startTime / 1000);
            const match = candles.find(c => Math.abs(c[0] - targetSec) < 86400);
            if (!match) throw new Error('Kraken had no matching candle for that date.');
            priceThen = parseFloat(match[4]); // close
            console.log('[regret] Kraken price:', priceThen);
          }
        }

        if (!priceThen || priceThen <= 0) throw new Error('Could not get price for that date. Try a nearby date.');

        // Get current price
        if (!currentPrice || currentPrice === 0) {
          currentPrice = await fetchBtcPriceMini();
        }
        if (!currentPrice) throw new Error('Could not load current BTC price. Refresh the page and try again.');

        // Calculate
        const btcBought = usd / priceThen;
        const sats = Math.round(btcBought * 1e8);
        const valueNow = btcBought * currentPrice;
        const gain = valueNow - usd;
        const mult = valueNow / usd;
        const isGain = gain >= 0;

        const purchaseDate = chosen.toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });

        // Main display
        $('regret-price-then').textContent = '$' + priceThen.toLocaleString('en-US', { maximumFractionDigits: 2 });
        $('regret-btc-then').textContent = btcBought.toFixed(8) + ' BTC';
        $('regret-value-now').textContent = '$' + valueNow.toLocaleString('en-US', { maximumFractionDigits: 2 });
        $('regret-value-now').style.color = isGain ? 'var(--green)' : 'var(--red)';
        $('regret-gain').textContent = (isGain ? '+' : '') + '$' + gain.toLocaleString('en-US', { maximumFractionDigits: 2 }) + ' (' + mult.toFixed(1) + 'x)';
        $('regret-gain').style.color = isGain ? 'var(--green)' : 'var(--red)';

        // Summary line
        let summary;
        if (mult >= 1000) summary = `On ${purchaseDate}, $${usd.toLocaleString()} bought ${btcBought.toFixed(6)} BTC at $${priceThen.toLocaleString()}. That stack is worth $${valueNow.toLocaleString('en-US',{maximumFractionDigits:0})} today ‚Äî a ${mult.toFixed(0)}x return. This is why people don't sell. üöÄ`;
        else if (mult >= 100) summary = `On ${purchaseDate}, $${usd.toLocaleString()} bought ${btcBought.toFixed(6)} BTC at $${priceThen.toLocaleString()}. Worth $${valueNow.toLocaleString('en-US',{maximumFractionDigits:0})} today. A ${mult.toFixed(0)}x return. The regret is real.`;
        else if (mult >= 10) summary = `On ${purchaseDate}, $${usd.toLocaleString()} bought ${btcBought.toFixed(6)} BTC at $${priceThen.toLocaleString()}. Worth $${valueNow.toLocaleString('en-US',{maximumFractionDigits:0})} today ‚Äî a ${mult.toFixed(1)}x gain.`;
        else if (mult >= 2)  summary = `On ${purchaseDate}, $${usd.toLocaleString()} bought ${btcBought.toFixed(6)} BTC at $${priceThen.toLocaleString()}. Worth $${valueNow.toLocaleString('en-US',{maximumFractionDigits:0})} today ‚Äî a ${mult.toFixed(1)}x gain. Not bad.`;
        else if (mult >= 1)  summary = `On ${purchaseDate}, $${usd.toLocaleString()} bought ${btcBought.toFixed(6)} BTC at $${priceThen.toLocaleString()}. You'd be up $${gain.toLocaleString('en-US',{maximumFractionDigits:0})} today. Holding pays.`;
        else summary = `On ${purchaseDate}, $${usd.toLocaleString()} bought ${btcBought.toFixed(6)} BTC at $${priceThen.toLocaleString()}. Worth $${valueNow.toLocaleString('en-US',{maximumFractionDigits:0})} today ‚Äî down ${((1-mult)*100).toFixed(1)}%. Time heals all wounds... usually.`;
        $('regret-summary').textContent = summary;

        // Breakdown
        $('re-spent').textContent = '$' + usd.toLocaleString('en-US', {maximumFractionDigits:2});
        $('re-price').textContent = '$' + priceThen.toLocaleString('en-US', {maximumFractionDigits:2});
        $('re-btc').textContent = btcBought.toFixed(8) + ' BTC';
        $('re-sats').textContent = sats.toLocaleString() + ' sats';
        $('re-now-price').textContent = '$' + fmt(Math.round(currentPrice));
        $('re-value').textContent = '$' + valueNow.toLocaleString('en-US', {maximumFractionDigits:2});
        $('re-value').style.color = isGain ? 'var(--green)' : 'var(--red)';
        $('re-gain').textContent = (isGain ? '+' : '') + '$' + gain.toLocaleString('en-US', {maximumFractionDigits:2}) + ' (' + mult.toFixed(2) + 'x)';
        $('re-gain').style.color = isGain ? 'var(--green)' : 'var(--red)';

        resEl.style.display = 'block';

      } catch(e) {
        errEl.textContent = 'Error: ' + (e.message || 'Something went wrong. Try again.');
        errEl.style.display = 'block';
      } finally {
        this.textContent = 'Calculate My Regret ‚Üí';
        this.disabled = false;
      }
    });

    // Allow Enter key on inputs
    ['regret-usd', 'regret-date'].forEach(id => {
      $(id).addEventListener('keydown', e => { if (e.key === 'Enter') $('regret-calc-btn').click(); });
    });

    loadCurrentPrice();
  </script>
</body>
</html>